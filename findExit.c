#pragma config(StandardModel, "EV3_REMBOT")
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

//variabel=====================================================
int orientasi = 0; //untuk ngecek untuk ke utara, barat, timur, selatan harus belok apa
									 //0 = robot sedang menghadap utara, 1 = timur, 2 = selatan, 3 = barat
									 //karena perubangan orientasi hanya saat persimpangan, belokan tanpa simpangan
 									 //dianggap lurus

//fungsi=======================================================

//gerakan dasar***********************************************************
//gerak lurus pada persimpangan
void lurus()
{
	setMotorSpeed(leftMotor, 50);
	setMotorSpeed(rightMotor, 50);
	sleep(1000);
}

//belok kanan pada persimpangan
void belokKanan()
{
	setMotorSpeed(leftMotor, 50);
	setMotorSpeed(rightMotor, 50);
	sleep(700);
	setMotorSpeed(rightMotor, 0);
	setMotorSpeed(leftMotor, 50);
	sleep(1000);
}

//belok kiri pada persimpangan
void belokKiri()
{
	setMotorSpeed(leftMotor, 50);
	setMotorSpeed(rightMotor, 50);
	sleep(700);
	setMotorSpeed(rightMotor, 50);
	setMotorSpeed(leftMotor, 0);
	sleep(1000);
}

//bergerak memutar balik robot
void putarBalik()
{
	setMotorSpeed(rightMotor, 0);
	setMotorSpeed(leftMotor, 50);
	sleep(1000);
}

//gerak mengikuti garis hitam
void maju()
{
	float temp = (float) getColorReflected(colorSensor) * 2 / 5 + 20;
	motor[leftMotor]  = temp;
	motor[rightMotor] = 80 - temp;
}

//gerakan oriental********************************************************
//bergerak ke utara
void utara()
{
	if(orientasi == 0)
	{
		lurus();
	}
	else if(orientasi == 1)
	{
		belokKiri();
	}
	else if(orientasi == 2)
	{
		putarBalik();
	}
	else if(orientasi == 3)
	{
		belokKanan();
	}
	//set orientasi baru
	orientasi = 0;
}

//bergerak ke timur
void timur()
{
	if(orientasi == 0)
	{
		belokKanan();
	}
	else if(orientasi == 1)
	{
		lurus();
	}
	else if(orientasi == 2)
	{
		belokKiri();
	}
	else if(orientasi == 3)
	{
		putarBalik();
	}
	//set orientasi baru
	orientasi = 1;
}

//bergerak ke selatan
void selatan()
{
	if(orientasi == 0)
	{
		putarBalik();
	}
	else if(orientasi == 1)
	{
		belokKanan();
	}
	else if(orientasi == 2)
	{
		lurus();
	}
	else if(orientasi == 3)
	{
		belokKiri();
	}
	//set orientasi baru
	orientasi = 2;
}

//bergerak ke barat
void barat()
{
	if(orientasi == 0)
	{
		belokKiri();
	}
	else if(orientasi == 1)
	{
		putarBalik();
	}
	else if(orientasi == 2)
	{
		belokKanan();
	}
	else if(orientasi == 3)
	{
		lurus();
	}
	//set orientasi baru
	orientasi = 3;
}

//bergerak memutar balik dan mengganti orientasi
void buntu()
{
	if(orientasi == 0)
	{
		selatan();
	}
	else if(orientasi == 1)
	{
		barat();
	}
	else if(orientasi == 2)
	{
		utara();
	}
	else if(orientasi == 3)
	{
		timur();
	}
}

//cariJalan******************************************************************


//cek apakah ada jalan lurus
void cekLurus()
{
	setMotorSpeed(leftMotor, 50);
	setMotorSpeed(rightMotor, 50);
	sleep(600);
	if(getColorName(colorSensor)==colorBlack)
	{
		//placeHolder
		setMotorSpeed(leftMotor, 0);
		setMotorSpeed(rightMotor, 0);
		sleep(3000);
	}

	//balik lagi
	setMotorSpeed(leftMotor, -50);
	setMotorSpeed(rightMotor, -50);
	sleep(600);
}

//cek apakah ada jalan kanan
void cekKanan()
{
	setMotorSpeed(leftMotor, 60);
	setMotorSpeed(rightMotor, 40);
	sleep(800);
	if(getColorName(colorSensor)==colorBlack)
	{
		//placeHolder
		setMotorSpeed(leftMotor, 0);
		setMotorSpeed(rightMotor, 0);
		sleep(3000);
	}

	//balik lagi
	//setMotorSpeed(leftMotor, -60);
	//setMotorSpeed(rightMotor, -40);
	//sleep(800);
}

//cek apakah ada jalan kiri
void cekKiri()
{
	setMotorSpeed(leftMotor, 0);
	setMotorSpeed(rightMotor, 50);
	sleep(300);
	if(getColorName(colorSensor)==colorBlack)
	{
		//placeHolder
		setMotorSpeed(leftMotor, 0);
		setMotorSpeed(rightMotor, 0);
		sleep(3000);
	}

		//balik lagi
	setMotorSpeed(leftMotor, 0);
	setMotorSpeed(rightMotor, -50);
	sleep(300);
}

void cekSimpangan()
{
	cekLurus();
	cekKanan();
	cekKiri();
}

//gerakan yang dilakukan robot***********************************************
void gerak()
{
	repeat(forever)
	{
		if(getColorName(colorSensor)==colorBlue)
		{
			break;
		}
		else if(getColorName(colorSensor)==colorGreen)
		{
			cekSimpangan();
		}
		else if(getColorName(colorSensor)==colorRed)
		{
			buntu();
		}
		else //warna item
		{
			maju();
		}
	}
}


task main()
{
	//maju dikit biar kaga kena biru
	setMotorSpeed(leftMotor, 50);
	setMotorSpeed(rightMotor, 50);
	sleep(3000);
	setMotorSpeed(rightMotor, 50);
	setMotorSpeed(leftMotor, 0);
	sleep(300);

	//mulai algoritma gerak warna
	gerak();
}
